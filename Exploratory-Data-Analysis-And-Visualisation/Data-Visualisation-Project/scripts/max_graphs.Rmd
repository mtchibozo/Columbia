---
title: "Max graphs"
output: html_document
---

```{r}
library(ggplot2)
```



II - Superhero movie analysis

```{r}
df_superhero <- clean_superhero # import clean_superhero (from text, readr) directly to your environment
ticket_prices <- avg_ticket_price # import avg.ticket.price (from text, readr) from the datasets folder
ticket_prices[30,1] <- 1989

df_database <- main_ds_without_superhero #import main_ds_without_superhero (from Text, base) from the datasets folder - IMPORTANT : UNSELECT STRINGS AS FACTORS

```

II - 1) Evaluating popularity over the years

To evaluate the popularity of superhero movies, we evaluate the number of people who have bought a ticket to see a movie. We roughly estimated the number of people who bought a ticket to be the revenue of the movie divided by the ticket price.

As the revenue graphs from Part I - Genre Analysis show, revenue for movies has consistently increased over time, but this increase is in large part due to inflation. To have a metric that is no longer affected by inflation, we will consider the number of people who bought a ticket for a movie to be the revenue of said movie divided by the average ticket price of the year in which the movie was released. 


```{r}
#getting revenue
movie_revenue <- sapply(df_superhero["gross_usa"],as.numeric)

#getting the year of release of each movie
movie_year <- sapply(df_superhero["year"],as.numeric)

ticket_year <- sapply(ticket_prices[1],as.numeric)
ticket_year[30] <- 1989
#Defining popularity as the quotient between revenue and average ticket price of the year

popularity <- c(1:length(movie_year))

for (i in 1:length(movie_year)){
  year <- movie_year[i]
  for (j in 1:length(ticket_year)){
      if (ticket_year[j] == year){
          ticket_price <- ticket_prices[j,2][[1]]
          ticket_price <- as.numeric(substr(ticket_price,2,nchar(ticket_price)))
          popularity[i] <- movie_revenue[i]/ticket_price
        }
  }
}

```

We group movies by year and compute the average popularity



```{r}
pop_frame = data.frame(year=movie_year,popularity=popularity)

scatter <- ggplot(pop_frame, aes(year, popularity)) + geom_point()
scatter +  labs(x = "Release Year", y = "Popularity (people)") +
  ggtitle("Popularity of superhero movies by release year")
```

We will now plot this new metric to see how popularity has evolved over the years.
We need to group 

```{r}
mean_pop_frame <- aggregate(pop_frame[, 2], list(pop_frame$year), mean)[ -c(1,2,35), ]

ggplot(data = mean_pop_frame, aes(x = Group.1, y = x))+
  geom_line(color = "blue") +
  ggtitle("Popularity of Superhero Movies over time") +
  labs(x = "year", y = "popularity (nb of tickets bought)")
```

The data indicates that superher movies (Marvel + DC) were popular before 1981 and made a resurgence since 1995. We also observe that from 1981 to 1995, superhero (Marvel + DC) movies were not popular at all. This indicates that the popularity of superhero movies has gone through several phases: popular(before 1981), unpopular (1981 - 1995), popular (since 1995). 

As the above graph shows, even in recent years, the popularity of superhero movies is not as evident as one might expect. While there are evident variations for the number of superhero movie tickets bought over time since 1995, when we account for inflation, there is no significant  increasing trend indicating that more people are buying movie tickets for superhero movies.

This could mean that the increase in revenue generated by superhero movies is primarily caused by inflation, and in reality, superhero movies in recent years have not been more popular than they were 20 years ago.


II - 5) Average 

Compare average ROI of regular dataset and superhero movies (time series)  (don't forget to remove superhero movies from main dataset)


```{r}
superheroes_ROI <- df_superhero["gross_worldwide"]-df_superhero["budget"]
superheroes_year <- df_superhero["year"]
#superhero is for superhero database, regular is for the regular database (with 4000 rows)
regular_ROI <- df_database["revenue"]-df_database["budget"]

regular_year <- df_database["release_date"]

for (i in 1:nrow(regular_year)){
  regular_year[i,] <- substr(regular_year[i,],1,4)
}

regular_year <- data.frame(sapply(regular_year, function(x) as.numeric(as.character(x))))


```


```{r}
superhero_roi_frame = data.frame(year=superheroes_year,ROI=superheroes_ROI)

mean_superhero_roi_frame <- aggregate(superhero_roi_frame[, 2], list(superhero_roi_frame$year), mean)[-c(1,2),]
mean_superhero_roi_frame = mean_superhero_roi_frame[!is.na(mean_superhero_roi_frame$x),]
mean_superhero_roi_frame$type = rep("Superhero", nrow(mean_superhero_roi_frame))

regular_roi_frame = data.frame(year=regular_year,ROI=regular_ROI)
mean_regular_roi_frame <- aggregate(regular_roi_frame[,2],list(regular_roi_frame$release_date),mean)[-c(40),]
mean_regular_roi_frame$type = rep("Regular", nrow(mean_regular_roi_frame))

mean_merged = rbind(mean_superhero_roi_frame,mean_regular_roi_frame)


ggplot(mean_merged, aes(Group.1,x, color=type)) + geom_line() + guides(color = guide_legend(reverse = TRUE)) +
  xlab('year') +
  ylab('ROI (revenue-budget)') + ggtitle("Average Return on Investment of Superhero and regular Movies") 
```

While the regular movie Return on Investment line shows that ROI for movies overall has increased over time, the superhero ROI line increases much faster. This indicates that superhero movies are more bankable. That is, studios can expect a higher return from superhero movies than from regular movies. This explains the trend of movie studios jumping on the "superhero movie bandwagon". Since they can expect to make more money on average from those movies, it is in their financial interest to focus particularly on this category of movies.


II - 6) Boxplots for Marvel and DC movies

Boxplot for scores faceted by Marvel movie or DC movie, with median, outliers, etc.

```{r}
# boxplot by studio 
ggplot(df_superhero, aes(x = reorder(studio, -imdb_rating, median), y = imdb_rating)) + 
  # plotting
  geom_boxplot(fill = "#cc9a38", color = "#473e2c") + stat_boxplot(geom="errorbar") +
  # formatting
  ggtitle("IMDB Score of Marvel vs. DC movies",
          subtitle = "Boxplots of IMDB score by movie studio") +
  labs(x = "Movie Studio", y = "IMDBScore") +
  theme_grey(16) +
  theme(plot.title = element_text(face = "bold")) +
  theme(plot.subtitle = element_text(face = "bold", color = "grey35")) +
  theme(plot.caption = element_text(color = "grey68"))
```

This graph shows that while Marvel and DC movies have a similar median rating on IMDB (7 vs. 6.5), the interquartile range for DC movies is much larger. This means that Marvel movies are more consistent when compared to DC movies in the matters of IMDB scores. There is more variability for DC movies, 25% of which have an IMDB score of less than 5.2 .

It is worth noting that the best rated DC movie achieves a higher IMDB score than the best rated Marvel movie.

Wh_at about the Rotten Tomatoes scores?

```{r}
#Remove % from critic score and audience score
df_superhero$critic_score_rt = as.numeric(substr(df_superhero$critic_score_rt,1,nchar(df_superhero$critic_score_rt)-1))
df_superhero$audience_score_rt = as.numeric(substr(df_superhero$audience_score_rt,1,nchar(df_superhero$audience_score_rt)-1))
```


Rotten Tomatoes Audience Score:

```{r}
# boxplot bystudio 
df_superhero1 = df_superhero[!is.na(df_superhero$audience_score_rt),]

ggplot(df_superhero1, aes(x = reorder(studio, -audience_score_rt, median), y = audience_score_rt)) + 
  # plotting
  geom_boxplot(fill = "#cc9a38", color = "#473e2c") + stat_boxplot(geom="errorbar") +
  # formatting
  ggtitle("Rotten Tomatoes Audience Score",
          subtitle = "Boxplots of RT Audience score by studio") +
  labs(x = "studio", y = "Audience score (%)") +
  theme_grey(16) +
  theme(plot.title = element_text(face = "bold")) +
  theme(plot.subtitle = element_text(face = "bold", color = "grey35")) +
  theme(plot.caption = element_text(color = "grey68"))
```

Unsurprisingly, the Rotten Tomatoes Audience boxplots look similar to those in the IMDB graphs. This is because the IMDB grade is based on audience feedback. Once again, the medians are almost identical for Marvel and DC movies (75% vs. 70%). We can assume that the audience which gave a score on IMDB is similar to the audience which gave a score on Rotten Tomatoes. 

It is worth noting that the interquartile range for the DC movies is noticeably larger than in the previous graph. This indicates that, when given a scale out of 100, the audience gave harsher reviews to the DC movies than for the IMDB scale (out of 10).


Rotten Tomatoes Critic Score : 

```{r}
# boxplot bystudio 
df_superhero2 = df_superhero[!is.na(df_superhero$critic_score_rt),]

ggplot(df_superhero2, aes(x = reorder(studio, -critic_score_rt, median), y = critic_score_rt)) + 
  # plotting
  geom_boxplot(fill = "#cc9a38", color = "#473e2c") + stat_boxplot(geom="errorbar") + 
  # formatting
  ggtitle("Rotten Tomatoes Critic Score",
          subtitle = "Boxplots of RT Critic score by studio") +
  labs(x = "studio", y = "Critic score (%)") +
  theme_grey(16) +
  theme(plot.title = element_text(face = "bold")) +
  theme(plot.subtitle = element_text(face = "bold", color = "grey35")) +
  theme(plot.caption = element_text(color = "grey68"))
```

It is worth taking a pause to interpret this graph. Whereas the audience ratings (IMDB, Rotten Tomatoes) had a similar median for Marvel and DC movies, the critic scores are much more severe. The median for marvel movies is 77%, whereas the median for DC movies is 55%. Critics clearly seem to prefer Marvel movies, while audiences are more undecided.


III - Director Analysis

2) Most versatile directors: find type of graph (not time series) to plot number of different genres per director. (bar chart)


